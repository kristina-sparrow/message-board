(()=>{"use strict";var e={520:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function u(e){try{a(o.next(e))}catch(e){s(e)}}function i(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,i)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createNewMessage=t.getAllMessages=void 0;const s=r(n(974));t.getAllMessages=(e,t)=>o(void 0,void 0,void 0,(function*(){const{limit:n=10,since:o=0}=e.query,r=yield s.default.find().sort({added:-1}).skip(Number(o)).limit(Number(n));t.status(200).json({allMessages:r})})),t.createNewMessage=(e,t)=>o(void 0,void 0,void 0,(function*(){const{username:n,text:o}=e.body;try{const e={username:n,text:o},r=new s.default(e);yield r.save(),t.status(201).json({msg:"Created new message",messageDB:r})}catch(e){t.sendStatus(500),console.error(e)}}))},917:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function u(e){try{a(o.next(e))}catch(e){s(e)}}function i(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,i)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(185));t.default=()=>o(void 0,void 0,void 0,(function*(){try{s.default.set("strictQuery",!0),yield s.default.connect(`${process.env.DB_URI}`,{}),console.log("Connected to database")}catch(e){console.log(e)}}))},560:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(553);t.default=(e,t,n)=>{const r=(0,o.validationResult)(e);if(!r.isEmpty())return t.status(400).json(r);n()}},974:function(e,t,n){var o=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const r=n(185),s=new r.Schema({username:{type:String,required:[!0,"Username is required"]},text:{type:String,required:[!0,"Text is required"]},added:{type:Date,default:Date.now}});s.methods.toJSON=function(){const e=this.toObject(),{__v:t,state:n}=e;return o(e,["__v","state"])},t.default=(0,r.model)("Message",s)},716:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(860),s=n(553),u=o(n(560)),i=n(520),a=(0,r.Router)();a.get("/",i.getAllMessages),a.post("/",[(0,s.check)("username","Username is required").not().isEmpty(),(0,s.check)("text","Text is required").not().isEmpty(),u.default],i.createNewMessage),t.default=a},873:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(142)),s=o(n(860)),u=o(n(185)),i=o(n(917)),a=o(n(582)),c=o(n(716)),l=(0,s.default)();r.default.config();const d=process.env.PORT||3e3;(0,i.default)(),l.use((0,a.default)()),l.use(s.default.urlencoded({extended:!1})),l.use(s.default.json()),l.use("/",c.default),l.all("*",((e,t,n)=>{t.sendStatus(404)})),u.default.connection.once("open",(()=>{l.listen(d,(()=>console.log(`server running on port ${d}`)))}))},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},553:e=>{e.exports=require("express-validator")},185:e=>{e.exports=require("mongoose")}},t={};!function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(873)})();